@using Radzen
@using Radzen.Blazor
@using ResidencyRoll.Web.Data

<RadzenStack Gap="0.5rem">
    <RadzenLabel Text="@Label" />
    <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Start">
        <RadzenStack Gap="0.25rem" Style="flex: 1;">
            <RadzenAutoComplete @bind-Value="@searchText" 
                                Data="@filteredAirports" 
                                TextProperty="DisplayName"
                                Placeholder="Search by IATA code or city (e.g., LHR or London)"
                                Change="@OnAirportSelected"
                                LoadData="@OnLoadData"
                                Style="width: 100%;"
                                FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                                FilterDelay="300" />
            @if (!string.IsNullOrEmpty(City))
            {
                <RadzenText TextStyle="TextStyle.Caption" Style="color: #666;">
                    @City, @Country
                </RadzenText>
            }
        </RadzenStack>
        
        @if (!string.IsNullOrEmpty(SelectedTimezone) && ShowTimezoneOffset)
        {
            <RadzenBadge BadgeStyle="BadgeStyle.Info" 
                         Text="@GetTimezoneOffset()" 
                         Style="margin-top: 0.5rem;" />
        }
    </RadzenStack>
    
    @if (ShowManualOverride && !string.IsNullOrEmpty(SelectedTimezone))
    {
        <RadzenStack Gap="0.25rem">
            <RadzenCheckBox @bind-Value="@manualOverride" Name="manualOverride" />
            <RadzenLabel Text="Manual timezone override" Component="manualOverride" Style="font-size: 0.875rem;" />
            
            @if (manualOverride)
            {
                <RadzenDropDown @bind-Value="@SelectedTimezone" 
                                Data="@allTimezones" 
                                TextProperty="DisplayName"
                                ValueProperty="TimezoneId"
                                AllowFiltering="true"
                                FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                                Placeholder="Select timezone manually"
                                Style="width: 100%; margin-top: 0.5rem;"
                                Change="@OnManualTimezoneChanged" />
            }
        </RadzenStack>
    }
</RadzenStack>
